<%- model_class = Post -%>

<div class="page-header">
  <h1>Users & Friendships</h1>
</div>

<%= form_tag(users_index_path, :method => 'get', class: 'col-sm-6 col-md-6 nav navbar-nav navbar-left search') do %>
    <div class="input-group">
      <%= text_field_tag :search, params[:search], class: 'form-control', placeholder: 'Find user' %>
      <div class="input-group-btn">
        <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
      </div>
    </div>
<% end %>

<table class="table table-striped">
  <thead>
  <tr>
    <th></th>
    <th>User name</th>
    <th>Email</th>
    <th>Last login</th>
  </tr>
  </thead>
  <tbody>
  <% @users.each do |user| %>
      <tr>
        <td><p class="image round-image-40-table"><%= image_tag(user.avatar.url(:thumb)) %></p></td>
        <td style="vertical-align: middle;"><%= link_to "#{user.full_name}", user_path(user.id), class: 'btn-link stronger' %></td>
        <td style="vertical-align: middle;"><%= user.email %></td>
        <td style="vertical-align: middle;"><%= last_login_format(user.last_sign_in_at) %></td>
        <td style="vertical-align: middle;">

          <% if current_user.friends_with?(user) %>
              <%= link_to '<i class="glyphicon glyphicon-remove-sign"></i> Cancel friendship'.html_safe,
                          friend_path(user),
                          :method => 'delete',
                          :class => 'btn btn-danger btn-xs' %>
              You are friends.

          <% elsif current_user.pending_friend?(user) %>
              An invitation was sent.

          <% elsif current_user.requested_friend?(user) %>
              <%= link_to '<i class="glyphicon glyphicon-hand-up"></i> Accept'.html_safe,
                          friend_path(user, way: :accept),
                          :method => 'put',
                          :class => 'btn btn-success btn-xs' %>
              <%= link_to '<i class="glyphicon glyphicon-hand-down"></i> Decline'.html_safe,
                          friend_path(user, way: :decline),
                          :method => 'put',
                          :class => 'btn btn-warning btn-xs' %>
              <%= "#{user.full_name} wants to be your friend. " %>
          <% else %>
              <%= link_to '<i class="glyphicon glyphicon-hand-left"></i> Add Friend'.html_safe,
                          friends_path(:user_id => user),
                          :method => 'post',
                          :class => 'btn btn-success btn-xs' %>
          <% end %>
        </td>
      </tr>
  <% end %>
  </tbody>
</table>
